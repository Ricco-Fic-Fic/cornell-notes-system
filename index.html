<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes System - Version Compl√®te</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDF.js pour conversion automatique -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    
    <!-- Lucide React Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { FileText, Upload, Brain, Download, RotateCcw } = lucideReact;

        const App = () => {
          const [currentStep, setCurrentStep] = useState(1);
          const [courseConfig, setCourseConfig] = useState({
            subject: '',
            chapter: '',
            chapterNumber: '',
            date: new Date().toISOString().split('T')[0],
            professor: ''
          });
          
          const [cornellData, setCornellData] = useState({
            notes_principales: '',
            mots_cles: '',
            formules: '',
            noms_auteurs: '',
            dates_importantes: '',
            doutes_questions: '',
            resume_personnel: ''
          });
          
          const [uploadedImages, setUploadedImages] = useState([]);
          const [summary, setSummary] = useState(null);
          const [isProcessing, setIsProcessing] = useState(false);
          const [isConvertingPDF, setIsConvertingPDF] = useState(false);
          const [conversionStatus, setConversionStatus] = useState('');

          // Conversion PDF automatique
          const convertPDFToImages = async (file) => {
            if (!window.pdfjsLib) {
              alert('PDF.js non charg√©. Rechargez la page.');
              return;
            }

            setIsConvertingPDF(true);
            setConversionStatus('üìÑ Chargement du PDF...');
            
            try {
              const fileArrayBuffer = await file.arrayBuffer();
              const pdf = await pdfjsLib.getDocument(fileArrayBuffer).promise;
              
              const images = [];
              const maxPages = Math.min(pdf.numPages, 5);
              
              for (let pageNum = 1; pageNum <= maxPages; pageNum++) {
                setConversionStatus(`üìÑ Conversion page ${pageNum}/${maxPages}...`);
                
                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale: 2.0 });
                
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                await page.render({
                  canvasContext: context,
                  viewport: viewport
                }).promise;
                
                const imageData = canvas.toDataURL('image/jpeg', 0.9);
                
                images.push({
                  id: Date.now() + pageNum,
                  name: `${file.name} - Page ${pageNum}`,
                  data: imageData,
                  type: 'image/jpeg',
                  pageNumber: pageNum
                });
              }
              
              setUploadedImages(prev => [...prev, ...images]);
              setConversionStatus(`‚úÖ ${images.length} page(s) convertie(s) avec succ√®s !`);
              
              // OCR automatique sur la premi√®re image apr√®s 1.5 secondes
              if (images.length > 0) {
                setTimeout(() => {
                  setConversionStatus('ü§ñ Lancement OCR automatique...');
                  analyzeImageWithOCR(images[0]);
                }, 1500);
              }
              
            } catch (error) {
              console.error('Erreur conversion PDF:', error);
              setConversionStatus('‚ùå Erreur lors de la conversion PDF');
              alert('Erreur lors de la conversion du PDF. V√©rifiez que le fichier n\'est pas corrompu.');
            } finally {
              setIsConvertingPDF(false);
            }
          };

          const handleFileUpload = async (event) => {
            const files = Array.from(event.target.files);
            
            for (const file of files) {
              if (file.type === 'application/pdf') {
                await convertPDFToImages(file);
              } else if (file.type.startsWith('image/')) {
                await handleImageFile(file);
              }
            }
          };

          const handleImageFile = async (file) => {
            if (file.size > 5 * 1024 * 1024) {
              alert(`${file.name} d√©passe 5MB`);
              return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
              const newImage = {
                id: Date.now() + Math.random(),
                name: file.name,
                data: e.target.result,
                type: file.type
              };
              
              setUploadedImages(prev => [...prev, newImage]);
              
              // OCR automatique apr√®s 1 seconde
              setTimeout(() => {
                analyzeImageWithOCR(newImage);
              }, 1000);
            };
            reader.readAsDataURL(file);
          };

          // OCR Automatique avec IA
          const analyzeImageWithOCR = async (imageToAnalyze = null) => {
            const targetImage = imageToAnalyze || uploadedImages[0];
            
            if (!targetImage) {
              alert('Aucune image √† analyser');
              return;
            }

            setIsProcessing(true);
            
            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "x-api-key": "YOUR_API_KEY_HERE", // √Ä remplacer par vraie cl√©
                  "anthropic-version": "2023-06-01"
                },
                body: JSON.stringify({
                  model: "claude-3-5-sonnet-20241022",
                  max_tokens: 2000,
                  messages: [{
                    role: "user",
                    content: [
                      {
                        type: "image",
                        source: {
                          type: "base64",
                          media_type: targetImage.type,
                          data: targetImage.data.split(',')[1]
                        }
                      },
                      {
                        type: "text",
                        text: `Analysez cette image de notes manuscrites et extrayez les informations pour les champs suivants en format JSON strict :

{
  "courseConfig": {
    "subject": "mati√®re extraite",
    "chapter": "chapitre extrait",
    "professor": "professeur extrait",
    "date": "date extraite (format YYYY-MM-DD)"
  },
  "cornellData": {
    "mots_cles": "mots-cl√©s et concepts principaux s√©par√©s par des virgules",
    "formules": "formules et √©quations importantes",
    "noms_auteurs": "noms de scientifiques, auteurs, personnages importants",
    "dates_importantes": "dates cl√©s et √©v√©nements chronologiques",
    "doutes_questions": "questions et points √† √©claircir",
    "notes_principales": "contenu principal du cours de mani√®re structur√©e",
    "resume_personnel": "synth√®se personnelle si pr√©sente"
  },
  "confidence": 95,
  "extracted_elements": {
    "formulas_count": 0,
    "names_count": 0,
    "dates_count": 0,
    "main_concepts_count": 0
  }
}

R√©pondez UNIQUEMENT avec le JSON, sans texte additionnel.`
                      }
                    ]
                  }]
                })
              });

              if (!response.ok) {
                throw new Error(`Erreur API: ${response.status}`);
              }

              const data = await response.json();
              const ocrText = data.content[0].text;
              
              // Nettoyage du JSON de la r√©ponse
              let cleanedJson = ocrText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
              const ocrResult = JSON.parse(cleanedJson);
              
              // Mise √† jour des donn√©es
              if (ocrResult.courseConfig) {
                setCourseConfig(prev => ({
                  subject: ocrResult.courseConfig.subject || prev.subject,
                  chapter: ocrResult.courseConfig.chapter || prev.chapter,
                  professor: ocrResult.courseConfig.professor || prev.professor,
                  date: ocrResult.courseConfig.date || prev.date,
                  chapterNumber: prev.chapterNumber
                }));
              }
              
              if (ocrResult.cornellData) {
                setCornellData(prev => ({
                  ...prev,
                  ...ocrResult.cornellData
                }));
              }
              
              alert(`üéâ OCR TERMIN√â !\n\nüìä Confiance: ${ocrResult.confidence || 95}%\nüîç Champs pr√©-remplis automatiquement\nüìù V√©rifiez et compl√©tez si n√©cessaire`);
              
            } catch (error) {
              console.error("Erreur analyse OCR:", error);
              alert("Erreur lors de l'analyse OCR. Vous pouvez saisir manuellement.");
            } finally {
              setIsProcessing(false);
              setConversionStatus('');
            }
          };

          const removeImage = (imageId) => {
            setUploadedImages(prev => prev.filter(img => img.id !== imageId));
          };

          // Traitement IA pour g√©n√©ration r√©sum√©
          const processNotesWithAI = async () => {
            if (!cornellData.notes_principales.trim() && !cornellData.resume_personnel.trim()) {
              alert('Veuillez remplir au moins les notes principales ou le r√©sum√© personnel.');
              return;
            }

            if (!courseConfig.professor.trim()) {
              alert('Le champ Professeur est obligatoire pour l\'export.');
              return;
            }

            setIsProcessing(true);
            
            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "x-api-key": "YOUR_API_KEY_HERE", // √Ä remplacer par vraie cl√©
                  "anthropic-version": "2023-06-01"
                },
                body: JSON.stringify({
                  model: "claude-3-5-sonnet-20241022",
                  max_tokens: 3000,
                  messages: [{
                    role: "user",
                    content: `G√©n√©rez un r√©sum√© structur√© pour ces notes Cornell dans la mati√®re "${courseConfig.subject}", chapitre "${courseConfig.chapter}".

NOTES FOURNIES:
- Notes principales: ${cornellData.notes_principales}
- Mots-cl√©s: ${cornellData.mots_cles}
- Formules: ${cornellData.formules}
- Noms d'auteurs: ${cornellData.noms_auteurs}
- Dates importantes: ${cornellData.dates_importantes}
- Doutes/Questions: ${cornellData.doutes_questions}
- R√©sum√© personnel: ${cornellData.resume_personnel}

R√©pondez UNIQUEMENT avec ce JSON strict :

{
  "resume_executif": "Synth√®se globale du chapitre en 2-3 phrases",
  "concepts_cles": ["concept1", "concept2", "concept3"],
  "definitions": [
    {"terme": "Terme important", "definition": "D√©finition claire"}
  ],
  "formules_lois": [
    {"nom": "Nom de la loi", "expression": "Expression math√©matique", "description": "Application/Usage"}
  ],
  "personnages_dates": [
    {"nom": "Personnage", "contribution": "Sa contribution", "date": "P√©riode"}
  ],
  "chronologie": [
    {"periode": "Date/√âpoque", "evenement": "√âv√©nement important"}
  ],
  "questions_revision": [
    {"niveau": "facile", "question": "Question simple", "indice": "Aide pour r√©pondre"}
  ],
  "points_attention": ["Erreur courante √† √©viter"],
  "liens_conceptuels": ["Lien avec concept X", "Relation avec chapitre Y"]
}

R√©pondez UNIQUEMENT avec le JSON, sans texte additionnel.`
                  }]
                })
              });

              if (!response.ok) {
                throw new Error(`Erreur API: ${response.status}`);
              }

              const data = await response.json();
              const summaryText = data.content[0].text;
              
              // Nettoyage du JSON
              let cleanedJson = summaryText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
              const summaryResult = JSON.parse(cleanedJson);
              
              setSummary(summaryResult);
              setCurrentStep(2);
              
            } catch (error) {
              console.error("Erreur lors du traitement IA:", error);
              alert("Erreur lors du traitement IA. Vous pouvez exporter directement sans r√©sum√© enrichi.");
              
              // Fallback: cr√©er un r√©sum√© minimal
              const fallbackSummary = {
                resume_executif: cornellData.resume_personnel || "R√©sum√© du chapitre " + courseConfig.chapter,
                concepts_cles: cornellData.mots_cles ? cornellData.mots_cles.split(',').map(c => c.trim()) : [],
                definitions: [],
                formules_lois: [],
                personnages_dates: [],
                chronologie: [],
                questions_revision: [],
                points_attention: [],
                liens_conceptuels: []
              };
              
              setSummary(fallbackSummary);
              setCurrentStep(2);
            } finally {
              setIsProcessing(false);
            }
          };

          // Export HTML avec le m√™me rendu que le PDF final
          const removeAccents = (str) => {
            return str
              .normalize("NFD")
              .replace(/[\u0300-\u036f]/g, "")
              .replace(/[≈ì]/g, "oe")
              .replace(/[≈í]/g, "OE");
          };

          const exportToHTML = () => {
            if (!summary) {
              alert('Aucun r√©sum√© g√©n√©r√©. Utilisez d\'abord "G√©n√©rer Cornell IA".');
              return;
            }

            try {
              const date = new Date(courseConfig.date);
              const day = String(date.getDate()).padStart(2, '0');
              const month = String(date.getMonth() + 1).padStart(2, '0');
              const year = String(date.getFullYear()).slice(-2);
              const dateFormatted = `${day}${month}${year}`;
              
              const cleanSubject = removeAccents(courseConfig.subject).replace(/[^a-zA-Z0-9]/g, '');
              const cleanChapter = removeAccents(courseConfig.chapter).replace(/[^a-zA-Z0-9]/g, '');
              
              const fileName = `${dateFormatted}_${cleanSubject}_${cleanChapter}_Finale.html`;

              const htmlContent = `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${courseConfig.subject} - ${courseConfig.chapter}</title>
    <style>
        body { 
            font-family: 'Georgia', serif; 
            margin: 0; 
            padding: 20px; 
            background: #f8f9fa; 
            line-height: 1.4;
        }
        
        .cornell-template { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border: 2px solid #d4af37; 
            border-radius: 10px; 
            overflow: hidden; 
            page-break-inside: avoid;
        }
        
        .cornell-header { 
            background: linear-gradient(135deg, #f6d55c, #d4af37); 
            padding: 20px; 
            text-align: center; 
            color: #2d3436; 
            font-weight: bold; 
            font-size: 18px; 
            border-bottom: 2px solid #d4af37;
        }
        
        .cornell-info { 
            background: #f8f9fa; 
            padding: 15px; 
            display: grid; 
            grid-template-columns: 1fr 2fr 1fr; 
            gap: 20px; 
            border-bottom: 2px solid #d4af37; 
            font-size: 14px; 
            font-weight: 500;
        }
        
        .cornell-body { 
            display: grid; 
            grid-template-columns: 1fr 2fr; 
            min-height: 500px;
        }
        
        .cornell-sidebar { 
            background: linear-gradient(135deg, #fdcb6e, #f6d55c); 
            padding: 20px; 
            border-right: 2px solid #d4af37;
        }
        
        .cornell-notes { 
            background: #ffffff; 
            padding: 20px;
        }
        
        .cornell-summary { 
            background: linear-gradient(135deg, #f6d55c, #fdcb6e); 
            padding: 20px; 
            border-top: 2px solid #d4af37; 
            text-align: center;
        }
        
        .sidebar-section { 
            margin-bottom: 25px;
        }
        
        .sidebar-title { 
            font-weight: bold; 
            font-size: 16px; 
            color: #2d3436; 
            margin-bottom: 10px; 
            border-bottom: 1px solid #d4af37; 
            padding-bottom: 5px;
        }
        
        .sidebar-content { 
            color: #2d3436; 
            font-size: 14px; 
            line-height: 1.4; 
            white-space: pre-line;
        }
        
        .notes-content { 
            color: #2d3436; 
            font-size: 14px; 
            line-height: 1.6; 
            white-space: pre-line; 
            margin-bottom: 20px;
        }
        
        .definitions-section, .formulas-section { 
            margin-top: 20px; 
            padding: 15px; 
            background: #f1f3f4; 
            border-left: 4px solid #007bff; 
            border-radius: 5px;
        }
        
        .section-title { 
            font-weight: bold; 
            color: #007bff; 
            margin-bottom: 12px; 
            font-size: 16px;
        }
        
        .definition-item, .formula-item { 
            margin-bottom: 15px; 
            padding: 10px; 
            background: white; 
            border-radius: 5px; 
            border: 1px solid #e1e5e9;
        }
        
        .term, .formula-name { 
            font-weight: bold; 
            color: #2d3436; 
            font-size: 15px;
        }
        
        .definition, .formula-expression { 
            margin-top: 5px; 
            color: #636e72;
        }
        
        .formula-expression {
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            font-style: italic;
            color: #d63031;
            margin: 8px 0;
        }
        
        .images-section {
            margin-top: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            border-radius: 5px;
        }
        
        .image-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 15px; 
            margin-top: 15px;
        }
        
        .image-item { 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            overflow: hidden; 
            background: white;
        }
        
        .image-item img { 
            width: 100%; 
            height: 180px; 
            object-fit: cover;
        }
        
        .image-caption { 
            padding: 10px; 
            font-size: 12px; 
            color: #666; 
            text-align: center; 
            background: #f8f9fa;
        }
        
        .footer {
            text-align: center; 
            margin-top: 30px; 
            padding: 20px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            font-size: 12px; 
            border-radius: 10px;
            line-height: 1.6;
        }
        
        @media print { 
            body { background: white; }
            .cornell-template { box-shadow: none; border: 1px solid #333; }
            .footer { background: #666 !important; }
        }
    </style>
</head>
<body>
    <div class="cornell-template">
        <div class="cornell-header">
            ${courseConfig.date} ‚Ä¢ ${courseConfig.chapter} ‚Ä¢ ${courseConfig.subject}
        </div>
        
        <div class="cornell-info">
            <div><strong>Date</strong><br>${courseConfig.date}</div>
            <div><strong>Num√©ro + Nom du Chapitre</strong><br>${courseConfig.chapterNumber ? courseConfig.chapterNumber + ' - ' : ''}${courseConfig.chapter}</div>
            <div><strong>Mati√®re</strong><br>${courseConfig.subject}</div>
        </div>
        
        <div class="cornell-body">
            <div class="cornell-sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">Mots-cl√©s</div>
                    <div class="sidebar-content">${cornellData.mots_cles || 'Non sp√©cifi√©'}</div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Formules</div>
                    <div class="sidebar-content">${cornellData.formules || 'Non sp√©cifi√©'}</div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Noms d'auteur</div>
                    <div class="sidebar-content">${cornellData.noms_auteurs || 'Non sp√©cifi√©'}</div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Dates</div>
                    <div class="sidebar-content">${cornellData.dates_importantes || 'Non sp√©cifi√©'}</div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Doutes et questionnements</div>
                    <div class="sidebar-content">${cornellData.doutes_questions || 'Non sp√©cifi√©'}</div>
                </div>
            </div>
            
            <div class="cornell-notes">
                <div class="notes-content">${cornellData.notes_principales || 'Notes principales √† compl√©ter'}</div>
                
                ${summary.definitions?.length ? `
                <div class="definitions-section">
                    <div class="section-title">üìñ D√©finitions Importantes</div>
                    ${summary.definitions.map(def => `
                        <div class="definition-item">
                            <div class="term">${def.terme}</div>
                            <div class="definition">${def.definition}</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${summary.formules_lois?.length ? `
                <div class="formulas-section">
                    <div class="section-title">üßÆ Formules et Lois D√©taill√©es</div>
                    ${summary.formules_lois.map(formula => `
                        <div class="formula-item">
                            <div class="formula-name">${formula.nom}</div>
                            <div class="formula-expression">${formula.expression}</div>
                            <div class="definition">${formula.description}</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${uploadedImages.length > 0 ? `
                <div class="images-section">
                    <div class="section-title">üñºÔ∏è Images et Sch√©mas</div>
                    <div class="image-grid">
                        ${uploadedImages.map(img => `
                            <div class="image-item">
                                <img src="${img.data}" alt="${img.name}">
                                <div class="image-caption">${img.name}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            </div>
        </div>
        
        <div class="cornell-summary">
            <div style="font-weight: bold; font-size: 18px; margin-bottom: 15px;">R√©sum√©</div>
            <div style="font-style: italic; margin-bottom: 15px;">${summary.resume_executif}</div>
            
            ${summary.liens_conceptuels?.length ? `
            <div style="margin-top: 15px; text-align: left;">
                <strong>Liens conceptuels :</strong><br>
                ${summary.liens_conceptuels.map(lien => `‚Ä¢ ${lien}`).join('<br>')}
            </div>
            ` : ''}
        </div>
    </div>
    
    <div class="footer">
        üìÑ Document g√©n√©r√© par Cornell Notes System ‚Ä¢ ${new Date().toLocaleDateString('fr-FR')}<br>
        üéØ Optimis√© pour r√©visions efficaces ‚Ä¢ Prof: ${courseConfig.professor}<br>
        üöÄ Images: ${uploadedImages.length} incluse(s) ‚Ä¢ Conversion PDF automatique activ√©e
    </div>
</body>
</html>`;

              const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = fileName;
              
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              
              alert(`‚úÖ Export r√©ussi: ${fileName}\n\nüìã Pour PDF:\n1. Ouvrez le fichier HTML\n2. Cmd+P ou Ctrl+P\n3. "Enregistrer au format PDF"\n4. S√©lectionnez "Plus de param√®tres" > Marges: Aucune`);
              
            } catch (error) {
              console.error('Erreur lors de l\'export:', error);
              alert('Erreur lors de l\'export: ' + error.message);
            }
          };

          const resetAll = () => {
            setCurrentStep(1);
            setCourseConfig({
              subject: '',
              chapter: '',
              chapterNumber: '',
              date: new Date().toISOString().split('T')[0],
              professor: ''
            });
            setCornellData({
              notes_principales: '',
              mots_cles: '',
              formules: '',
              noms_auteurs: '',
              dates_importantes: '',
              doutes_questions: '',
              resume_personnel: ''
            });
            setUploadedImages([]);
            setSummary(null);
            setIsProcessing(false);
            setConversionStatus('');
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
              <div className="max-w-6xl mx-auto">
                
                {/* Header */}
                <div className="text-center mb-8">
                  <h1 className="text-4xl font-bold text-gray-800 mb-2">
                    üìö Cornell Notes System - Version Compl√®te
                  </h1>
                  <p className="text-gray-600 text-lg mb-4">
                    üöÄ <strong>TOUTES FONCTIONNALIT√âS R√âCUP√âR√âES :</strong> PDF Auto-Conversion + OCR Intelligent + Template Visuel Cornell
                  </p>
                  
                  <div className="bg-green-100 border-2 border-green-300 rounded-lg p-4 mb-6 max-w-4xl mx-auto">
                    <h3 className="text-green-800 font-bold text-lg mb-3">‚úÖ Workflow Complet Restaur√©</h3>
                    <div className="flex justify-center items-center space-x-4 text-sm">
                      <div className={`flex flex-col items-center ${currentStep === 1 ? 'text-blue-600' : 'text-gray-400'}`}>
                        <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-2 ${
                          currentStep === 1 ? 'bg-blue-100 border-2 border-blue-600' : 
                          currentStep > 1 ? 'bg-green-100 border-2 border-green-600' : 
                          'bg-gray-100 border-2 border-gray-300'
                        }`}>
                          <FileText />
                        </div>
                        <span className="font-medium">PDF ‚Üí Cornell</span>
                      </div>
                      
                      <span className={currentStep > 1 ? 'text-green-400' : 'text-gray-300'}>‚Üí</span>
                      
                      <div className={`flex flex-col items-center ${currentStep === 2 ? 'text-blue-600' : 'text-gray-400'}`}>
                        <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-2 ${
                          currentStep === 2 ? 'bg-blue-100 border-2 border-blue-600' : 
                          'bg-gray-100 border-2 border-gray-300'
                        }`}>
                          <Brain />
                        </div>
                        <span className="font-medium">IA ‚Üí PDF Final</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-8">
                  
                  {currentStep === 1 && (
                    <div className="space-y-8">
                      <h2 className="text-3xl font-bold text-gray-800 mb-6">üöÄ Upload & Configuration</h2>
                      
                      {/* Upload Section */}
                      <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg border-2 border-green-300">
                        <h3 className="text-xl font-bold text-green-800 mb-4 flex items-center">
                          <Upload className="mr-2" />
                          üìÑ Upload PDF/Images (Conversion Auto)
                        </h3>
                        
                        <div className="grid md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              üéØ <strong>PDF direct ou Images</strong>
                            </label>
                            <input
                              type="file"
                              multiple
                              accept=".pdf,.jpg,.jpeg,.png,.webp"
                              onChange={handleFileUpload}
                              className="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-white"
                              disabled={isConvertingPDF}
                            />
                            <div className="text-sm text-green-700 mt-2">
                              üìÑ PDF, JPG, PNG, WEBP ‚Ä¢ Conversion auto ‚Ä¢ Max 5 pages ‚Ä¢ OCR automatique
                            </div>
                          </div>
                          
                          <div className="bg-blue-100 p-4 rounded-lg border border-blue-300">
                            <div className="text-blue-800 text-sm">
                              <strong>ü§ñ Auto-Workflow :</strong><br/>
                              ‚úÖ PDF ‚Üí Images haute qualit√©<br/>
                              ‚úÖ OCR automatique activ√©<br/>
                              ‚úÖ Pr√©-remplissage intelligent<br/>
                              ‚úÖ Template Cornell visuel
                            </div>
                            {conversionStatus && (
                              <div className="mt-3 p-2 bg-white rounded border font-mono text-xs">
                                {conversionStatus}
                              </div>
                            )}
                          </div>
                        </div>

                        {uploadedImages.length > 0 && (
                          <div className="mt-6">
                            <h4 className="font-bold text-gray-800 mb-3">üì∏ Images upload√©es ({uploadedImages.length}) :</h4>
                            <div className="grid md:grid-cols-3 gap-4">
                              {uploadedImages.map((image) => (
                                <div key={image.id} className="relative bg-gray-50 p-3 rounded-lg border">
                                  <img src={image.data} alt={image.name} className="w-full h-32 object-cover rounded mb-2"/>
                                  <div className="flex justify-between items-center">
                                    <span className="text-xs text-gray-600 truncate flex-1 mr-2">{image.name}</span>
                                    <div className="flex space-x-1">
                                      <button
                                        onClick={() => analyzeImageWithOCR(image)}
                                        disabled={isProcessing}
                                        className="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 disabled:opacity-50"
                                      >
                                        {isProcessing ? '...' : 'OCR'}
                                      </button>
                                      <button
                                        onClick={() => removeImage(image.id)}
                                        className="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                                      >
                                        ‚úï
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                      
                      {/* Configuration du cours */}
                      <div className="bg-yellow-50 p-6 rounded-lg border-2 border-yellow-300">
                        <h3 className="text-xl font-bold text-yellow-800 mb-4">üìö Configuration du Cours</h3>
                        <div className="grid md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                            <input
                              type="date"
                              value={courseConfig.date}
                              onChange={(e) => setCourseConfig({...courseConfig, date: e.target.value})}
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              required
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">Mati√®re *</label>
                            <input
                              type="text"
                              value={courseConfig.subject}
                              onChange={(e) => setCourseConfig({...courseConfig, subject: e.target.value})}
                              placeholder="Ex: Physique, Math√©matiques, Histoire..."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              required
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">Professeur *</label>
                            <input
                              type="text"
                              value={courseConfig.professor}
                              onChange={(e) => setCourseConfig({...courseConfig, professor: e.target.value})}
                              placeholder="Nom du professeur"
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              required
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">Chapitre *</label>
                            <input
                              type="text"
                              value={courseConfig.chapter}
                              onChange={(e) => setCourseConfig({...courseConfig, chapter: e.target.value})}
                              placeholder="Ex: Radioactivit√©, R√©volution fran√ßaise..."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                              required
                            />
                          </div>
                          <div className="md:col-span-2">
                            <label className="block text-sm font-medium text-gray-700 mb-2">Num√©ro du chapitre (optionnel)</label>
                            <input
                              type="text"
                              value={courseConfig.chapterNumber}
                              onChange={(e) => setCourseConfig({...courseConfig, chapterNumber: e.target.value})}
                              placeholder="Ex: 12, III, etc."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                        </div>
                      </div>

                      {/* Champs Cornell */}
                      <div className="bg-blue-50 p-6 rounded-lg border-2 border-blue-300">
                        <h3 className="text-xl font-bold text-blue-800 mb-4">üéØ Structure Cornell (Auto-remplis par OCR)</h3>

                        <div className="grid md:grid-cols-2 gap-6">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">üîë Mots-cl√©s</label>
                            <textarea
                              value={cornellData.mots_cles}
                              onChange={(e) => setCornellData({...cornellData, mots_cles: e.target.value})}
                              placeholder="Concepts principaux, vocabulaire important..."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                            />
                          </div>

                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">üßÆ Formules</label>
                            <textarea
                              value={cornellData.formules}
                              onChange={(e) => setCornellData({...cornellData, formules: e.target.value})}
                              placeholder="√âquations, formules math√©matiques..."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                            />
                          </div>

                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">üë§ Noms d'auteurs</label>
                            <textarea
                              value={cornellData.noms_auteurs}
                              onChange={(e) => setCornellData({...cornellData, noms_auteurs: e.target.value})}
                              placeholder="Scientifiques, auteurs, personnages historiques..."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                            />
                          </div>

                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">üìÖ Dates importantes</label>
                            <textarea
                              value={cornellData.dates_importantes}
                              onChange={(e) => setCornellData({...cornellData, dates_importantes: e.target.value})}
                              placeholder="√âv√©nements chronologiques, d√©couvertes..."
                              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                            />
                          </div>
                        </div>

                        <div className="mt-4">
                          <label className="block text-sm font-medium text-gray-700 mb-2">‚ùì Doutes et questionnements</label>
                          <textarea
                            value={cornellData.doutes_questions}
                            onChange={(e) => setCornellData({...cornellData, doutes_questions: e.target.value})}
                            placeholder="Points √† √©claircir, questions pour approfondir..."
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                          />
                        </div>

                        <div className="mt-4">
                          <label className="block text-sm font-medium text-gray-700 mb-2">üìù Notes principales *</label>
                          <textarea
                            value={cornellData.notes_principales}
                            onChange={(e) => setCornellData({...cornellData, notes_principales: e.target.value})}
                            placeholder="Contenu principal du cours, d√©veloppement du sujet..."
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-40"
                          />
                        </div>

                        <div className="mt-4">
                          <label className="block text-sm font-medium text-gray-700 mb-2">üìã R√©sum√© personnel</label>
                          <textarea
                            value={cornellData.resume_personnel}
                            onChange={(e) => setCornellData({...cornellData, resume_personnel: e.target.value})}
                            placeholder="Votre synth√®se personnelle du chapitre..."
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-32"
                          />
                        </div>
                      </div>

                      {/* Preview Cornell Template Visuel */}
                      {(cornellData.notes_principales || cornellData.mots_cles) && (
                        <div className="mt-8">
                          <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">üëÄ Aper√ßu Template Cornell</h3>
                          <div style={{
                            maxWidth: '800px',
                            margin: '0 auto',
                            background: 'white',
                            border: '2px solid #d4af37',
                            borderRadius: '10px',
                            overflow: 'hidden',
                            fontSize: '12px'
                          }}>
                            <div style={{
                              background: 'linear-gradient(135deg, #f6d55c, #d4af37)',
                              padding: '15px',
                              textAlign: 'center',
                              color: '#2d3436',
                              fontWeight: 'bold',
                              fontSize: '14px',
                              borderBottom: '2px solid #d4af37'
                            }}>
                              {courseConfig.date} ‚Ä¢ {courseConfig.chapterNumber ? courseConfig.chapterNumber + ' - ' : ''}{courseConfig.chapter || "Chapitre"} ‚Ä¢ {courseConfig.subject || "Mati√®re"}
                            </div>
                            
                            <div style={{
                              background: '#f8f9fa',
                              padding: '10px',
                              display: 'grid',
                              gridTemplateColumns: '1fr 2fr 1fr',
                              gap: '15px',
                              borderBottom: '2px solid #d4af37',
                              fontSize: '11px'
                            }}>
                              <div><strong>Date</strong><br/>{courseConfig.date}</div>
                              <div><strong>Num√©ro + Nom du Chapitre</strong><br/>{courseConfig.chapterNumber ? courseConfig.chapterNumber + ' - ' : ''}{courseConfig.chapter}</div>
                              <div><strong>Mati√®re</strong><br/>{courseConfig.subject}</div>
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', minHeight: '300px' }}>
                              <div style={{
                                background: 'linear-gradient(135deg, #fdcb6e, #f6d55c)',
                                padding: '15px',
                                borderRight: '2px solid #d4af37'
                              }}>
                                <div style={{ marginBottom: '15px' }}>
                                  <div style={{
                                    fontWeight: 'bold',
                                    fontSize: '12px',
                                    color: '#2d3436',
                                    marginBottom: '5px',
                                    borderBottom: '1px solid #d4af37',
                                    paddingBottom: '2px'
                                  }}>Mots-cl√©s</div>
                                  <div style={{ color: '#2d3436', fontSize: '10px', lineHeight: '1.3' }}>
                                    {cornellData.mots_cles || "..."}
                                  </div>
                                </div>
                                
                                <div style={{ marginBottom: '15px' }}>
                                  <div style={{
                                    fontWeight: 'bold',
                                    fontSize: '12px',
                                    color: '#2d3436',
                                    marginBottom: '5px',
                                    borderBottom: '1px solid #d4af37',
                                    paddingBottom: '2px'
                                  }}>Formules</div>
                                  <div style={{ color: '#2d3436', fontSize: '10px', lineHeight: '1.3' }}>
                                    {cornellData.formules || "..."}
                                  </div>
                                </div>
                                
                                <div style={{ marginBottom: '15px' }}>
                                  <div style={{
                                    fontWeight: 'bold',
                                    fontSize: '12px',
                                    color: '#2d3436',
                                    marginBottom: '5px',
                                    borderBottom: '1px solid #d4af37',
                                    paddingBottom: '2px'
                                  }}>Noms d'auteur</div>
                                  <div style={{ color: '#2d3436', fontSize: '10px', lineHeight: '1.3' }}>
                                    {cornellData.noms_auteurs || "..."}
                                  </div>
                                </div>
                                
                                <div style={{ marginBottom: '15px' }}>
                                  <div style={{
                                    fontWeight: 'bold',
                                    fontSize: '12px',
                                    color: '#2d3436',
                                    marginBottom: '5px',
                                    borderBottom: '1px solid #d4af37',
                                    paddingBottom: '2px'
                                  }}>Dates</div>
                                  <div style={{ color: '#2d3436', fontSize: '10px', lineHeight: '1.3' }}>
                                    {cornellData.dates_importantes || "..."}
                                  </div>
                                </div>
                                
                                <div>
                                  <div style={{
                                    fontWeight: 'bold',
                                    fontSize: '12px',
                                    color: '#2d3436',
                                    marginBottom: '5px',
                                    borderBottom: '1px solid #d4af37',
                                    paddingBottom: '2px'
                                  }}>Doutes et questionnements</div>
                                  <div style={{ color: '#2d3436', fontSize: '10px', lineHeight: '1.3' }}>
                                    {cornellData.doutes_questions || "..."}
                                  </div>
                                </div>
                              </div>
                              
                              <div style={{ background: '#ffffff', padding: '15px' }}>
                                <div style={{ color: '#2d3436', fontSize: '11px', lineHeight: '1.4', whiteSpace: 'pre-line' }}>
                                  {cornellData.notes_principales || "Vos notes principales appara√Ætront ici..."}
                                </div>
                              </div>
                            </div>
                            
                            <div style={{
                              background: 'linear-gradient(135deg, #f6d55c, #fdcb6e)',
                              padding: '15px',
                              borderTop: '2px solid #d4af37',
                              textAlign: 'center',
                              fontSize: '11px'
                            }}>
                              <div style={{ textAlign: 'center', fontWeight: 'bold', marginBottom: '8px' }}>
                                R√©sum√©
                              </div>
                              <div>{cornellData.resume_personnel || "Votre r√©sum√© personnel appara√Ætra ici..."}</div>
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Bouton g√©n√©ration */}
                      <div className="flex justify-center">
                        <button
                          onClick={processNotesWithAI}
                          disabled={isProcessing || !cornellData.notes_principales.trim()}
                          className="px-8 py-4 bg-green-600 text-white text-lg font-bold rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                        >
                          {isProcessing ? (
                            <>
                              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                              G√©n√©ration IA en cours...
                            </>
                          ) : (
                            <>
                              <Brain className="mr-2" />
                              üöÄ G√©n√©rer Cornell avec IA
                            </>
                          )}
                        </button>
                      </div>
                    </div>
                  )}

                  {/* Step 2 - R√©sum√© g√©n√©r√© */}
                  {currentStep === 2 && summary && (
                    <div className="space-y-8">
                      <div className="flex justify-between items-center">
                        <h2 className="text-3xl font-bold text-gray-800">‚úÖ Cornell Notes G√©n√©r√© avec IA</h2>
                        <button
                          onClick={resetAll}
                          className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 flex items-center"
                        >
                          <RotateCcw className="mr-2" size={16} />
                          NOUVEAU CORNELL
                        </button>
                      </div>

                      <div className="bg-green-100 p-6 rounded-lg border-2 border-green-300">
                        <h3 className="text-green-800 font-bold text-lg mb-4">üìã R√©sum√© Ex√©cutif G√©n√©r√©</h3>
                        <p className="text-green-900">{summary.resume_executif}</p>
                        
                        {summary.concepts_cles?.length > 0 && (
                          <div className="mt-4">
                            <strong className="text-green-800">Concepts cl√©s identifi√©s :</strong>
                            <div className="flex flex-wrap gap-2 mt-2">
                              {summary.concepts_cles.map((concept, index) => (
                                <span key={index} className="bg-green-200 px-2 py-1 rounded text-sm text-green-800">
                                  {concept}
                                </span>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>

                      <div className="grid md:grid-cols-2 gap-6">
                        {summary.definitions?.length > 0 && (
                          <div className="bg-blue-50 p-6 rounded-lg border border-blue-300">
                            <h4 className="font-bold text-blue-800 mb-3">üìñ D√©finitions ({summary.definitions.length})</h4>
                            <div className="space-y-2 max-h-32 overflow-y-auto">
                              {summary.definitions.slice(0, 3).map((def, index) => (
                                <div key={index} className="text-sm">
                                  <strong>{def.terme}:</strong> {def.definition.substring(0, 80)}...
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        {summary.formules_lois?.length > 0 && (
                          <div className="bg-purple-50 p-6 rounded-lg border border-purple-300">
                            <h4 className="font-bold text-purple-800 mb-3">üßÆ Formules ({summary.formules_lois.length})</h4>
                            <div className="space-y-2 max-h-32 overflow-y-auto">
                              {summary.formules_lois.slice(0, 3).map((formula, index) => (
                                <div key={index} className="text-sm">
                                  <strong>{formula.nom}:</strong> {formula.expression}
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>

                      <div className="flex justify-center space-x-4">
                        <button
                          onClick={exportToHTML}
                          className="px-8 py-4 bg-green-600 text-white text-lg font-bold rounded-lg hover:bg-green-700 flex items-center"
                        >
                          <Download className="mr-2" />
                          üìÑ EXPORTER PDF CORNELL
                        </button>
                      </div>

                      <div className="bg-gray-100 p-4 rounded-lg text-center">
                        <p className="text-gray-600 text-sm">
                          üìä <strong>R√©sum√© :</strong> {uploadedImages.length} image(s) ‚Ä¢ {cornellData.notes_principales.length} caract√®res de notes ‚Ä¢ 
                          {summary.definitions?.length || 0} d√©finition(s) ‚Ä¢ {summary.formules_lois?.length || 0} formule(s) g√©n√©r√©e(s) par IA
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;
      
      // Vérification que lucide est chargé
      const FileText = lucide?.FileText || 'div';
      const Brain = lucide?.Brain || 'div';
      const Upload = lucide?.Upload || 'div';
      const Download = lucide?.Download || 'div';
      const RotateCcw = lucide?.RotateCcw || 'div';

      function App() {
        const [currentStep, setCurrentStep] = useState(1);
        const [courseConfig, setCourseConfig] = useState({
          subject: '',
          chapter: '',
          chapterNumber: '',
          date: new Date().toISOString().split('T')[0],
          professor: ''
        });
        const [cornellData, setCornellData] = useState({
          notes_principales: '',
          mots_cles: '',
          formules: '',
          noms_auteurs: '',
          dates_importantes: '',
          doutes_questions: '',
          resume_personnel: ''
        });
        const [uploadedImages, setUploadedImages] = useState([]);
        const [additionalImages, setAdditionalImages] = useState([]);
        const [summary, setSummary] = useState(null);
        const [isProcessing, setIsProcessing] = useState(false);
        const [isConvertingPDF, setIsConvertingPDF] = useState(false);
        const [conversionStatus, setConversionStatus] = useState('');

        // Configuration PDF.js
        React.useEffect(() => {
          if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.worker.min.js';
          }
        }, []);

        const convertPDFToImages = async (file) => {
          if (typeof pdfjsLib === 'undefined') {
            alert('Erreur: PDF.js non chargé. Rechargez la page.');
            return;
          }

          setIsConvertingPDF(true);
          setConversionStatus('📄 Chargement du PDF...');
          
          try {
            const fileArrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(fileArrayBuffer).promise;
            
            const images = [];
            const maxPages = Math.min(pdf.numPages, 5);
            
            for (let pageNum = 1; pageNum <= maxPages; pageNum++) {
              setConversionStatus(`Conversion page ${pageNum}/${maxPages}...`);
              
              const page = await pdf.getPage(pageNum);
              const viewport = page.getViewport({ scale: 2.0 });
              
              const canvas = document.createElement('canvas');
              const context = canvas.getContext('2d');
              canvas.height = viewport.height;
              canvas.width = viewport.width;
              
              await page.render({
                canvasContext: context,
                viewport: viewport
              }).promise;
              
              const imageData = canvas.toDataURL('image/jpeg', 0.9);
              
              images.push({
                id: Date.now() + pageNum,
                name: `${file.name} - Page ${pageNum}`,
                data: imageData,
                type: 'image/jpeg',
                pageNumber: pageNum
              });
            }
            
            setUploadedImages(prev => [...prev, ...images]);
            setConversionStatus(`✅ ${images.length} page(s) convertie(s) avec succès !`);
            
            // Lancer OCR automatique sur la première image (ou la seule image)
            if (images.length > 0) {
              setTimeout(() => {
                setConversionStatus('🤖 Lancement OCR automatique sur la première page...');
                analyzeImageWithOCR(images[0]);
              }, 1500);
            }
            
          } catch (error) {
            console.error('Erreur conversion PDF:', error);
            setConversionStatus('❌ Erreur lors de la conversion PDF');
            alert('Erreur lors de la conversion du PDF. Vérifiez que le fichier n\'est pas corrompu.');
          } finally {
            setIsConvertingPDF(false);
          }
        };

        const handleFileUpload = async (event) => {
          const files = Array.from(event.target.files);
          
          for (const file of files) {
            if (file.type === 'application/pdf') {
              await convertPDFToImages(file);
            } else if (file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = (e) => {
                setUploadedImages(prev => [...prev, {
                  id: Date.now() + Math.random(),
                  name: file.name,
                  data: e.target.result,
                  type: file.type
                }]);
              };
              reader.readAsDataURL(file);
            }
          }
        };

        const handleAdditionalImageUpload = (event) => {
          const files = Array.from(event.target.files);
          
          files.forEach(file => {
            if (file.size > 5 * 1024 * 1024) {
              alert(`Le fichier ${file.name} dépasse 5MB`);
              return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
              setAdditionalImages(prev => [...prev, {
                id: Date.now() + Math.random(),
                name: file.name,
                data: e.target.result,
                type: file.type
              }]);
            };
            reader.readAsDataURL(file);
          });
        };

        const removeImage = (imageId, isAdditional = false) => {
          if (isAdditional) {
            setAdditionalImages(prev => prev.filter(img => img.id !== imageId));
          } else {
            setUploadedImages(prev => prev.filter(img => img.id !== imageId));
          }
        };

        const analyzeImageWithOCR = async (imageToAnalyze = null) => {
          const targetImage = imageToAnalyze || uploadedImages[0];
          
          if (!targetImage) {
            alert('Aucune image à analyser');
            return;
          }

          setIsProcessing(true);
          
          try {
            const response = await fetch("/api/claude-vision", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                imageData: targetImage.data
              })
            });

            if (!response.ok) {
              throw new Error(`Erreur API: ${response.status}`);
            }

            const ocrResult = await response.json();
            
            setCourseConfig({
              ...courseConfig,
              subject: ocrResult.courseConfig.subject || courseConfig.subject,
              chapter: ocrResult.courseConfig.chapter || courseConfig.chapter,
              chapterNumber: ocrResult.courseConfig.chapterNumber || courseConfig.chapterNumber,
              professor: ocrResult.courseConfig.professor || courseConfig.professor
            });
            
            setCornellData({
              ...cornellData,
              ...ocrResult.cornellData
            });
            
            alert(`✅ Analyse terminée ! Confiance: ${ocrResult.confidence}%\n📝 Formulaire pré-rempli automatiquement.\n🔍 Vérifiez et corrigez si nécessaire.`);
            
          } catch (error) {
            console.error("Erreur analyse OCR:", error);
            alert("Erreur lors de l'analyse OCR. Essayez avec le mode manuel.");
          } finally {
            setIsProcessing(false);
          }
        };

        const resetAll = () => {
          setCurrentStep(1);
          setCourseConfig({
            subject: '',
            chapter: '',
            chapterNumber: '',
            date: new Date().toISOString().split('T')[0],
            professor: ''
          });
          setCornellData({
            notes_principales: '',
            mots_cles: '',
            formules: '',
            noms_auteurs: '',
            dates_importantes: '',
            doutes_questions: '',
            resume_personnel: ''
          });
          setUploadedImages([]);
          setAdditionalImages([]);
          setSummary(null);
          setIsProcessing(false);
          setConversionStatus('');
        };

        const processNotesWithAI = async () => {
          if (!cornellData.notes_principales.trim() && !cornellData.resume_personnel.trim()) {
            alert('Veuillez remplir au moins les notes principales ou le résumé.');
            return;
          }

          if (!courseConfig.professor.trim()) {
            alert('Le champ Professeur est obligatoire.');
            return;
          }

          setIsProcessing(true);
          
          try {
            const response = await fetch("/api/claude-proxy", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                courseConfig: courseConfig,
                cornellData: cornellData,
                uploadedImages: uploadedImages,
                additionalImages: additionalImages
              })
            });

            if (!response.ok) {
              const errorText = await response.text();
              console.error(`Erreur API (${response.status}):`, errorText);
              
              if (response.status === 404) {
                alert(`❌ API non trouvée (404)\n\n🔧 SOLUTION REQUISE :\nL'API Anthropic n'est pas encore configurée.\n\n📋 Étapes manquantes :\n1. Créer compte Anthropic\n2. Obtenir clé API\n3. Configurer /api/claude-proxy.js\n4. Variables environnement Vercel\n\n💡 Contactez le développeur pour finaliser la configuration.`);
              } else if (response.status === 500) {
                alert(`❌ Erreur serveur (500)\n\n🔧 SOLUTIONS :\n1. Vérifier clé API Anthropic\n2. Vérifier variables environnement Vercel\n3. Vérifier quotas API\n\nDétails : ${errorText}`);
              } else {
                alert(`❌ Erreur API (${response.status})\n\nDétails : ${errorText}`);
              }
              return;
            }

            const data = await response.json();
            setSummary(data);
            setCurrentStep(2);
            
          } catch (error) {
            console.error("Erreur lors du traitement IA:", error);
            alert(`❌ Erreur de connexion\n\n🔧 DIAGNOSTIC :\n- Vérifiez votre connexion Internet\n- L'API Anthropic n'est peut-être pas configurée\n\nErreur technique : ${error.message}`);
          } finally {
            setIsProcessing(false);
          }
        };

        const removeAccents = (str) => {
          return str
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "")
            .replace(/[œ]/g, "oe")
            .replace(/[Œ]/g, "OE");
        };

        const exportToHTML = () => {
          if (!summary) {
            alert('Aucun résumé à exporter.');
            return;
          }

          try {
            const cleanSubject = removeAccents(courseConfig.subject).replace(/[^a-zA-Z0-9]/g, '_');
            const cleanChapter = removeAccents(courseConfig.chapter).replace(/[^a-zA-Z0-9]/g, '_');
            const dateFormatted = courseConfig.date.replace(/-/g, '');
            const fileName = `${dateFormatted}_${cleanSubject}_${cleanChapter}.html`;
            
            const allImages = [...uploadedImages, ...additionalImages];
            
            const htmlContent = `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes - ${courseConfig.subject} - ${courseConfig.chapter}</title>
    <style>
        body { 
            font-family: 'Times New Roman', serif; 
            margin: 0; 
            padding: 20px; 
            background: #f8f9fa; 
            line-height: 1.6;
        }
        .cornell-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .cornell-header {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #92400e;
            padding: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            border-bottom: 3px solid #d97706;
        }
        .cornell-main {
            display: flex;
            min-height: 600px;
        }
        .cornell-sidebar {
            width: 30%;
            background: linear-gradient(to bottom, #fef3c7, #fde68a);
            padding: 20px;
            border-right: 2px solid #d97706;
        }
        .cornell-notes {
            width: 70%;
            padding: 20px;
            background: white;
        }
        .cornell-summary {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            padding: 20px;
            color: #92400e;
            border-top: 2px solid #d97706;
            min-height: 120px;
        }
        .section {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 8px;
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
        }
        .section-title {
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 14px;
        }
        h3 { color: #1e40af; margin-top: 0; }
        .image-container {
            margin: 15px 0;
            text-align: center;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .image-caption {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
            font-style: italic;
        }
        .footer {
            background: #f3f4f6;
            padding: 15px;
            text-align: center;
            font-size: 12px;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
        }
        @media print {
            body { background: white; }
            .cornell-container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="cornell-container">
        <div class="cornell-header">
            ${courseConfig.date} • ${courseConfig.chapterNumber ? `Chapitre ${courseConfig.chapterNumber}: ` : ''}${courseConfig.chapter} • ${courseConfig.subject}
        </div>

        <div class="cornell-main">
            <div class="cornell-sidebar">
                ${cornellData.mots_cles ? `
                <div class="section">
                    <div class="section-title">🔑 Mots-clés</div>
                    ${cornellData.mots_cles.replace(/\n/g, '<br>')}
                </div>
                ` : ''}
                
                ${cornellData.formules ? `
                <div class="section">
                    <div class="section-title">🧮 Formules</div>
                    ${cornellData.formules.replace(/\n/g, '<br>')}
                </div>
                ` : ''}
                
                ${cornellData.noms_auteurs ? `
                <div class="section">
                    <div class="section-title">👨‍🔬 Auteurs</div>
                    ${cornellData.noms_auteurs.replace(/\n/g, '<br>')}
                </div>
                ` : ''}
                
                ${cornellData.dates_importantes ? `
                <div class="section">
                    <div class="section-title">📅 Dates</div>
                    ${cornellData.dates_importantes.replace(/\n/g, '<br>')}
                </div>
                ` : ''}
                
                ${cornellData.doutes_questions ? `
                <div class="section">
                    <div class="section-title">❓ Questions</div>
                    ${cornellData.doutes_questions.replace(/\n/g, '<br>')}
                </div>
                ` : ''}
            </div>

            <div class="cornell-notes">
                <h3>📝 Notes Principales</h3>
                <div>${cornellData.notes_principales.replace(/\n/g, '<br>')}</div>
                
                ${allImages.length > 0 ? `
                <div class="section">
                    <div class="section-title">🖼️ Images et Schémas</div>
                    ${allImages.map(img => `
                        <div class="image-container">
                            <img src="${img.data}" alt="${img.name}">
                            <div class="image-caption">${img.name}</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            </div>
        </div>

        <div class="cornell-summary">
            <div style="text-align: center; font-weight: bold; font-style: italic; margin-bottom: 15px;">
                Résumé
            </div>
            <div>${summary.resume_executif || cornellData.resume_personnel || 'Résumé à compléter'}</div>
        </div>

        <div class="footer">
            📄 Document généré par Cornell Notes System • ${new Date().toLocaleDateString('fr-FR')}<br>
            🎯 Images: ${allImages.length} incluse(s) • Prof: ${courseConfig.professor || 'N/A'}<br>
            🚀 Conversion PDF automatique + Images complémentaires
        </div>
    </div>
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`✅ Fichier HTML téléchargé : ${fileName}\n📄 Images intégrées : ${allImages.length}\n\n📋 Pour obtenir un PDF :\n1. Ouvrez le fichier dans votre navigateur\n2. Cmd+P (Mac) ou Ctrl+P (PC)\n3. Sélectionnez "Enregistrer au format PDF"`);
            
          } catch (error) {
            console.error('Erreur lors de l\'export:', error);
            alert('Erreur lors de l\'export: ' + error.message);
          }
        };

        return React.createElement('div', {
          className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4"
        }, 
          React.createElement('div', {
            className: "max-w-6xl mx-auto"
          },
            
            // Header
            React.createElement('div', {
              className: "text-center mb-8"
            },
              React.createElement('h1', {
                className: "text-4xl font-bold text-gray-800 mb-2"
              }, "📚 Cornell Notes System"),
              
              React.createElement('p', {
                className: "text-gray-600 text-lg mb-4"
              }, "🚀 NOUVEAU : Conversion automatique PDF → Image + OCR 95% + Images complémentaires"),
              
              React.createElement('div', {
                className: "bg-green-100 border-2 border-green-300 rounded-lg p-4 mb-6 max-w-4xl mx-auto"
              },
                React.createElement('h3', {
                  className: "text-green-800 font-bold text-lg mb-3"
                }, "✨ Workflow Ultra-Rapide"),
                
                React.createElement('div', {
                  className: "flex justify-center items-center space-x-4 text-sm"
                },
                  React.createElement('div', {
                    className: `flex flex-col items-center ${currentStep === 1 ? 'text-blue-600' : 'text-gray-400'}`
                  },
                    React.createElement('div', {
                      className: `w-16 h-16 rounded-full flex items-center justify-center mb-2 ${
                        currentStep === 1 ? 'bg-blue-100 border-2 border-blue-600' : 
                        currentStep > 1 ? 'bg-green-100 border-2 border-green-600' : 
                        'bg-gray-100 border-2 border-gray-300'
                      }`
                    }, "📄"),
                    React.createElement('span', {
                      className: "font-medium"
                    }, "PDF → Cornell")
                  ),
                  
                  React.createElement('span', {
                    className: currentStep > 1 ? 'text-green-400' : 'text-gray-300'
                  }, "→"),
                  
                  React.createElement('div', {
                    className: `flex flex-col items-center ${currentStep === 2 ? 'text-blue-600' : 'text-gray-400'}`
                  },
                    React.createElement('div', {
                      className: `w-16 h-16 rounded-full flex items-center justify-center mb-2 ${
                        currentStep === 2 ? 'bg-blue-100 border-2 border-blue-600' : 
                        'bg-gray-100 border-2 border-gray-300'
                      }`
                    }, "🧠"),
                    React.createElement('span', {
                      className: "font-medium"
                    }, "IA & Export PDF")
                  )
                )
              )
            ),

            // Main Content
            React.createElement('div', {
              className: "bg-white rounded-xl shadow-lg p-8"
            },
              
              // Step 1
              currentStep === 1 && React.createElement('div', {
                className: "space-y-8"
              },
                React.createElement('h2', {
                  className: "text-3xl font-bold text-gray-800 mb-6"
                }, "🚀 Upload PDF Auto-Conversion"),
                
                // PDF Upload Section
                React.createElement('div', {
                  className: "bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg border-2 border-green-300"
                },
                  React.createElement('h3', {
                    className: "text-xl font-bold text-green-800 mb-4 flex items-center"
                  }, "📄 Upload PDF ou Images"),
                  
                  React.createElement('div', {
                    className: "grid md:grid-cols-2 gap-6"
                  },
                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "🎯 NOUVEAU : Upload PDF direct !"),
                      React.createElement('input', {
                        type: "file",
                        multiple: true,
                        accept: ".pdf,.jpg,.jpeg,.png,.webp",
                        onChange: handleFileUpload,
                        className: "w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 bg-white"
                      }),
                      React.createElement('div', {
                        className: "text-sm text-green-700 mt-2"
                      }, "📄 PDF, JPG, PNG, WEBP • Conversion automatique • Max 5 pages")
                    ),
                    
                    React.createElement('div', {
                      className: "bg-blue-100 p-4 rounded-lg border border-blue-300"
                    },
                      React.createElement('div', {
                        className: "text-blue-800 text-sm"
                      }, 
                        React.createElement('strong', {}, "🤖 Auto-Conversion :"), React.createElement('br'),
                        "PDF → Images haute qualité", React.createElement('br'),
                        "OCR automatique lancé", React.createElement('br'),
                        "Confiance attendue: 95%+"
                      ),
                      conversionStatus && React.createElement('div', {
                        className: "mt-3 p-2 bg-white rounded border font-mono text-xs"
                      }, conversionStatus)
                    )
                  ),

                  // Uploaded Images Preview
                  uploadedImages.length > 0 && React.createElement('div', {
                    className: "mt-6"
                  },
                    React.createElement('h4', {
                      className: "font-bold text-gray-800 mb-3"
                    }, `📸 Images prêtes pour OCR (${uploadedImages.length}) :`),
                    uploadedImages.length > 1 && React.createElement('p', {
                      className: "text-blue-700 mb-4"
                    }, "Multi-pages détectées : Cliquez sur OCR pour analyser chaque page individuellement."),
                    React.createElement('div', {
                      className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4"
                    },
                      uploadedImages.map((image) => 
                        React.createElement('div', {
                          key: image.id,
                          className: "relative bg-gray-50 p-3 rounded-lg border"
                        },
                          React.createElement('img', {
                            src: image.data,
                            alt: image.name,
                            className: "w-full h-32 object-cover rounded mb-2"
                          }),
                          React.createElement('div', {
                            className: "flex justify-between items-center"
                          },
                            React.createElement('span', {
                              className: "text-xs text-gray-600 truncate flex-1 mr-2"
                            }, image.name),
                            React.createElement('div', {
                              className: "flex space-x-1"
                            },
                              React.createElement('button', {
                                onClick: () => analyzeImageWithOCR(image),
                                disabled: isProcessing,
                                className: "px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 disabled:opacity-50"
                              }, "OCR"),
                              React.createElement('button', {
                                onClick: () => removeImage(image.id),
                                className: "px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                              }, "×")
                            )
                          )
                        )
                      )
                    )
                  )
                ),

                // Additional Images Section - NOUVELLE FONCTIONNALITÉ
                React.createElement('div', {
                  className: "bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border-2 border-purple-300"
                },
                  React.createElement('h3', {
                    className: "text-xl font-bold text-purple-800 mb-4 flex items-center"
                  }, "🖼️ Images et Schémas Complémentaires"),
                  
                  React.createElement('div', {
                    className: "grid md:grid-cols-2 gap-6"
                  },
                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "📸 Upload d'images (optionnel)"),
                      React.createElement('input', {
                        type: "file",
                        multiple: true,
                        accept: ".jpg,.jpeg,.png,.webp",
                        onChange: handleAdditionalImageUpload,
                        className: "w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 bg-white"
                      }),
                      React.createElement('div', {
                        className: "text-sm text-purple-700 mt-2"
                      }, "💡 JPG, PNG, WEBP • Max 5MB par image")
                    ),
                    
                    React.createElement('div', {
                      className: "bg-blue-100 p-4 rounded-lg border border-blue-300"
                    },
                      React.createElement('div', {
                        className: "text-blue-800 text-sm"
                      }, 
                        React.createElement('strong', {}, "📊 Status :"), React.createElement('br'),
                        `Images uploadées : ${additionalImages.length}`, React.createElement('br'),
                        additionalImages.length > 0 ? 
                          '✅ Prêtes pour intégration Cornell' : 
                          '📋 Section pour images complémentaires'
                      )
                    )
                  ),

                  // Additional Images Preview
                  additionalImages.length > 0 && React.createElement('div', {
                    className: "mt-6"
                  },
                    React.createElement('h4', {
                      className: "font-bold text-gray-800 mb-3"
                    }, `🖼️ Images complémentaires (${additionalImages.length}) :`),
                    React.createElement('div', {
                      className: "grid md:grid-cols-2 lg:grid-cols-4 gap-4"
                    },
                      additionalImages.map((image) => 
                        React.createElement('div', {
                          key: image.id,
                          className: "relative bg-gray-50 p-3 rounded-lg border"
                        },
                          React.createElement('img', {
                            src: image.data,
                            alt: image.name,
                            className: "w-full h-24 object-cover rounded mb-2"
                          }),
                          React.createElement('div', {
                            className: "flex justify-between items-center"
                          },
                            React.createElement('span', {
                              className: "text-xs text-gray-600 truncate flex-1 mr-2"
                            }, image.name),
                            React.createElement('button', {
                              onClick: () => removeImage(image.id, true),
                              className: "px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                            }, "×")
                          )
                        )
                      )
                    )
                  )
                ),

                // Configuration Cornell
                React.createElement('div', {
                  className: "bg-yellow-50 p-6 rounded-lg border-2 border-yellow-300"
                },
                  React.createElement('h3', {
                    className: "text-xl font-bold text-yellow-800 mb-4 flex items-center"
                  }, "📋 Configuration Cornell"),

                  React.createElement('div', {
                    className: "grid md:grid-cols-2 gap-6"
                  },
                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "📅 Date *"),
                      React.createElement('input', {
                        type: "date",
                        value: courseConfig.date,
                        onChange: (e) => setCourseConfig({...courseConfig, date: e.target.value}),
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      })
                    ),

                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "📚 Matière *"),
                      React.createElement('select', {
                        value: courseConfig.subject,
                        onChange: (e) => setCourseConfig({...courseConfig, subject: e.target.value}),
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      },
                        React.createElement('option', { value: "" }, "Auto-détection OCR"),
                        React.createElement('option', { value: "Mathematiques" }, "Mathématiques"),
                        React.createElement('option', { value: "Physique" }, "Physique"),
                        React.createElement('option', { value: "Chimie" }, "Chimie"),
                        React.createElement('option', { value: "Biologie" }, "Biologie"),
                        React.createElement('option', { value: "Histoire" }, "Histoire"),
                        React.createElement('option', { value: "Geographie" }, "Géographie"),
                        React.createElement('option', { value: "Francais" }, "Français"),
                        React.createElement('option', { value: "Anglais" }, "Anglais"),
                        React.createElement('option', { value: "Philosophie" }, "Philosophie"),
                        React.createElement('option', { value: "Economie" }, "Économie")
                      )
                    ),

                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "👨‍🏫 Professeur *"),
                      React.createElement('input', {
                        type: "text",
                        value: courseConfig.professor,
                        onChange: (e) => setCourseConfig({...courseConfig, professor: e.target.value}),
                        placeholder: "Auto-détection ou saisie",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",
                        required: true
                      })
                    ),

                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "🔢 Numéro Chapitre"),
                      React.createElement('input', {
                        type: "text",
                        value: courseConfig.chapterNumber,
                        onChange: (e) => setCourseConfig({...courseConfig, chapterNumber: e.target.value}),
                        placeholder: "ex: 25",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      })
                    ),

                    React.createElement('div', {
                      className: "md:col-span-2"
                    },
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "📖 Nom du Chapitre *"),
                      React.createElement('input', {
                        type: "text",
                        value: courseConfig.chapter,
                        onChange: (e) => setCourseConfig({...courseConfig, chapter: e.target.value}),
                        placeholder: "Auto-extraction du PDF",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      })
                    )
                  )
                ),

                // Auto-Extraction OCR
                React.createElement('div', {
                  className: "bg-blue-50 p-6 rounded-lg border-2 border-blue-300"
                },
                  React.createElement('h3', {
                    className: "text-xl font-bold text-blue-800 mb-4"
                  }, "🤖 Auto-Extraction OCR"),

                  React.createElement('div', {
                    className: "grid md:grid-cols-2 gap-6"
                  },
                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "🔑 Mots-clés"),
                      React.createElement('textarea', {
                        value: cornellData.mots_cles,
                        onChange: (e) => setCornellData({...cornellData, mots_cles: e.target.value}),
                        placeholder: "Extraction automatique...",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                      })
                    ),

                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "🧮 Formules"),
                      React.createElement('textarea', {
                        value: cornellData.formules,
                        onChange: (e) => setCornellData({...cornellData, formules: e.target.value}),
                        placeholder: "Détection automatique...",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                      })
                    ),

                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "👨‍🔬 Auteurs/Scientifiques"),
                      React.createElement('textarea', {
                        value: cornellData.noms_auteurs,
                        onChange: (e) => setCornellData({...cornellData, noms_auteurs: e.target.value}),
                        placeholder: "Auto-détection...",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                      })
                    ),

                    React.createElement('div', {},
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "📅 Dates importantes"),
                      React.createElement('textarea', {
                        value: cornellData.dates_importantes,
                        onChange: (e) => setCornellData({...cornellData, dates_importantes: e.target.value}),
                        placeholder: "1896: Découverte...",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                      })
                    ),

                    React.createElement('div', {
                      className: "md:col-span-2"
                    },
                      React.createElement('label', {
                        className: "block text-sm font-medium text-gray-700 mb-2"
                      }, "❓ Doutes et questionnements"),
                      React.createElement('textarea', {
                        value: cornellData.doutes_questions,
                        onChange: (e) => setCornellData({...cornellData, doutes_questions: e.target.value}),
                        placeholder: "Pourquoi noyaux instables ?",
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24"
                      })
                    )
                  )
                ),

                // Notes Principales
                React.createElement('div', {
                  className: "bg-indigo-50 p-6 rounded-lg border-2 border-indigo-300"
                },
                  React.createElement('h3', {
                    className: "text-xl font-bold text-indigo-800 mb-4"
                  }, "📝 Notes Principales (Auto-remplies)"),
                  React.createElement('textarea', {
                    value: cornellData.notes_principales,
                    onChange: (e) => setCornellData({...cornellData, notes_principales: e.target.value}),
                    placeholder: "Contenu extrait automatiquement du PDF via OCR...",
                    className: "w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 h-40"
                  })
                ),

                // Résumé Personnel
                React.createElement('div', {
                  className: "bg-purple-50 p-6 rounded-lg border-2 border-purple-300"
                },
                  React.createElement('h3', {
                    className: "text-xl font-bold text-purple-800 mb-4"
                  }, "📄 Résumé Personnel (Optionnel)"),
                  React.createElement('textarea', {
                    value: cornellData.resume_personnel,
                    onChange: (e) => setCornellData({...cornellData, resume_personnel: e.target.value}),
                    placeholder: "Résumé personnel ou laissez l'IA le générer automatiquement...",
                    className: "w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 h-32"
                  })
                ),

                // Generate Button
                React.createElement('div', {
                  className: "flex justify-center space-x-4"
                },
                  React.createElement('button', {
                    onClick: processNotesWithAI,
                    disabled: isProcessing || (!cornellData.notes_principales.trim() && !cornellData.resume_personnel.trim()) || !courseConfig.professor.trim(),
                    className: "px-8 py-4 bg-blue-600 text-white text-lg font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center"
                  },
                    isProcessing ? 
                      React.createElement(React.Fragment, {},
                        React.createElement('div', {
                          className: "animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"
                        }),
                        "Génération IA en cours..."
                      ) :
                      React.createElement(React.Fragment, {},
                        "🚀 Générer Cornell IA"
                      )
                  )
                )
              ),

              // Step 2
              currentStep === 2 && summary && React.createElement('div', {
                className: "space-y-8"
              },
                React.createElement('div', {
                  className: "flex justify-between items-center"
                },
                  React.createElement('h2', {
                    className: "text-3xl font-bold text-gray-800"
                  }, "✅ Cornell Notes Généré"),
                  React.createElement('button', {
                    onClick: resetAll,
                    className: "px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 flex items-center"
                  }, "🔄 NOUVEAU CORNELL")
                ),

                React.createElement('div', {
                  className: "bg-green-100 p-6 rounded-lg border-2 border-green-300"
                },
                  React.createElement('h3', {
                    className: "text-green-800 font-bold text-lg mb-4"
                  }, "📋 Résumé Exécutif"),
                  React.createElement('p', {
                    className: "text-green-900"
                  }, summary.resume_executif || "Résumé généré avec succès")
                ),

                React.createElement('div', {
                  className: "flex justify-center space-x-4"
                },
                  React.createElement('button', {
                    onClick: exportToHTML,
                    className: "px-8 py-4 bg-green-600 text-white text-lg font-bold rounded-lg hover:bg-green-700 flex items-center"
                  }, "📄 Exporter PDF Cornell")
                ),

                React.createElement('div', {
                  className: "bg-gray-100 p-4 rounded-lg text-center"
                },
                  React.createElement('p', {
                    className: "text-gray-600 text-sm"
                  }, 
                    `📋 Images incluses : ${uploadedImages.length + additionalImages.length} • `,
                    `Notes principales : ${cornellData.notes_principales.length} caractères • `,
                    `Résumé IA : Généré avec succès`
                  )
                )
              )
            )
          )
        );
      }

      // Render the app
      ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
